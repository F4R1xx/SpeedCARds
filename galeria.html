<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeedCards - Galeria de Carros</title>
    <link rel="icon" href="./assets/icon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --background-dark: #0A0A0A;
            --background-light: #1A1A1A;
            --primary-red: #E01A4F;
            --primary-red-dark: #c01040;
            --text-light: #f0f2f5;
            --text-medium: #a0aec0;
            --border-color: rgba(255, 255, 255, 0.1);
            --font-body: 'Inter', sans-serif;
            --font-display: 'Orbitron', sans-serif;
            --glow-effect: 0 0 15px rgba(224, 26, 79, 0.7);
        }

        body {
            font-family: var(--font-body);
            background-color: var(--background-dark);
            background-image: radial-gradient(circle at top right, rgba(224, 26, 79, 0.1), transparent 40%),
                              radial-gradient(circle at bottom left, rgba(224, 26, 79, 0.1), transparent 40%);
            color: var(--text-light);
            overflow-x: hidden;
        }

        .font-orbitron { font-family: var(--font-display); }

        .glass-panel {
            background: rgba(26, 26, 26, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-color);
            border-radius: 1rem;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        .loader-container { background: var(--background-dark); }
        .loader {
            border-top-color: var(--primary-red);
            border-right-color: var(--primary-red);
            border-bottom-color: var(--primary-red);
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .manufacturer-button {
            background: linear-gradient(145deg, var(--background-light), #222222);
            border: 2px solid var(--border-color);
            color: var(--text-medium);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            position: relative;
            overflow: hidden;
            border-radius: 10px;
            padding: 1rem;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            text-align: center;
            text-decoration: none;
            min-height: 120px;
        }

        .manufacturer-button:hover {
            color: white;
            background: linear-gradient(145deg, var(--primary-red), #FF3C3C);
            border-color: white;
            transform: translateY(-3px) scale(1.02);
            z-index: 10;
        }

        .manufacturer-logo {
            max-width: 80px;
            height: auto;
            filter: drop-shadow(0 0 5px rgba(0,0,0,0.7));
            transition: transform 0.3s ease;
        }

        .manufacturer-button:hover .manufacturer-logo { transform: scale(1.1); }
        
        .all-cars-button {
            display: inline-block;
            background: linear-gradient(145deg, var(--primary-red), var(--primary-red-dark));
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 0 15px rgba(224, 26, 79, 0.5);
            border: 1px solid var(--primary-red);
        }
        .all-cars-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(224, 26, 79, 0.8);
        }

        .completed-collection {
            border-color: #3498db;
            box-shadow: 0 0 15px rgba(52, 152, 219, 0.5);
        }
    </style>
</head>
<body class="text-white">

    <div id="loader" class="loader-container fixed inset-0 flex flex-col items-center justify-center z-50">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-600 h-28 w-28"></div>
        <p class="mt-8 text-2xl font-orbitron text-red-400 animate-pulse">Carregando Galeria...</p>
    </div>

    <div id="app-container" class="hidden w-full min-h-screen flex flex-col">
        <header id="header-placeholder" class="sticky top-0 z-40 w-full"></header>
        <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="glass-panel p-4 sm:p-6 lg:p-8">
                <div class="flex flex-col lg:flex-row justify-between items-center mb-8 gap-4">
                    <h1 class="font-orbitron text-4xl md:text-5xl font-bold text-white text-center lg:text-left" style="text-shadow: var(--glow-effect);">GALERIA DE CARROS</h1>
                    <a href="manufacturer_gallery.html" class="all-cars-button font-orbitron">
                        VER COLEÇÃO COMPLETA
                    </a>
                </div>
                
                <section class="mb-12">
                    <h2 class="font-orbitron text-3xl md:text-4xl font-bold text-white mb-8" style="text-shadow: var(--glow-effect);">MONTADORAS</h2>
                    <div id="manufacturers-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
                </section>
            </div>
        </main>
    </div>

    <script type="module">
        import { auth, db } from './firebase.js';
        import { onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { ref, get } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-database.js";
        import { cards, manufacturers } from './cards.js'; 
        import { createHeader } from './menu.js'; 

        const loader = document.getElementById('loader');
        const appContainer = document.getElementById('app-container');
        const manufacturersContainer = document.getElementById('manufacturers-container');
        const headerPlaceholder = document.getElementById('header-placeholder');

        function renderManufacturers(userOwnedCardIds) {
            manufacturersContainer.innerHTML = '';
            const uniqueManufacturers = Object.keys(manufacturers).sort();

            uniqueManufacturers.forEach(name => {
                const button = document.createElement('a');
                button.href = `manufacturer_gallery.html?manufacturer=${encodeURIComponent(name)}`;
                button.className = 'manufacturer-button';
                
                const carsOfManufacturer = Object.values(manufacturers[name]);
                const totalCars = carsOfManufacturer.length;
                const ownedCarsCount = carsOfManufacturer.filter(carData => {
                    const cardId = Object.keys(cards).find(key => cards[key] === carData);
                    return userOwnedCardIds.includes(cardId);
                }).length;
                
                let collectionStatusHtml = '';
                if (totalCars > 0 && ownedCarsCount === totalCars) {
                    button.classList.add('completed-collection');
                    collectionStatusHtml = '<span class="text-xs text-blue-300 font-bold mt-1">Coleção Completa</span>';
                }

                button.innerHTML = `
                    <img src="./assets/${name.replace(/\s/g, '')}-Logo.png" alt="${name} Logo" class="manufacturer-logo">
                    <span class="font-orbitron text-lg">${name.toUpperCase()}</span>
                    ${collectionStatusHtml}
                `;
                manufacturersContainer.appendChild(button);
            });
        }

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                try {
                    const snapshot = await get(ref(db, 'users/' + user.uid));
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        createHeader(auth, userData, headerPlaceholder, 'galeria');
                        renderManufacturers(userData.cartas || []); 
                        appContainer.classList.remove('hidden');
                        loader.classList.add('hidden');
                    } else { await signOut(auth); }
                } catch (error) {
                    console.error("Erro ao buscar dados:", error);
                    await signOut(auth);
                }
            } else { window.location.href = 'index.html'; }
        });
    </script>
</body>
</html>

